# Создание телеграмм бота для мотиноринга времени, проведенного за определенной деятельностью

Данная работа выполнена студентами 3 курса Программной инженерии в рамках курса "Конструирование ПО" 
```
Садофьева Анастасия Сергеевна 5130904/30106
Бредюк Ростислав Константинович 5130904/30106
Ивойловская Юлия Романовна 5130904/30106
```

#### Определение проблемы:

Пользователям сложно объективно оценивать, сколько времени они тратят на важные для них виды деятельности. Ручной подсчёт времени неудобен и часто неточен, что приводит к неэффективному планированию своего времени, а также отслеживаю результата.

#### Выработка требований:

   1. Как пользователь, я хочу видеть свою статистику и анализировать прогресс, чтобы понимать, сколько времени я трачу на свои цели. Я хочу иметь возможность запросить отчёт за выбранный период по одной или всем активностям.
   2. Как пользователь, я хочу легко начать отслеживание активности, чтобы не отвлекаться на сложные настройки. Для этого я хочу нажать кнопку с названием заранее созданной деятельности, чтобы таймер запустился. Когда я закончу, я хочу отправить команду нажать кнопку "Завершить", чтобы остановить отсчёт и автоматически сохранить сессию.

Количество пользователей в сутки: 1000 пользователей
Период хранения информации: Вся информация о пользователи будет хранится по умолчанию в течении 5 лет. 

# Проект: Telegram-бот для мониторинга времени, проведённого за деятельностью


#### 1. Краткое описание проблемы и цели
   Проблема: пользователям трудно объективно отслеживать время, затраченное на различные задачи; ручной учёт неудобен и неточен.
   Цель: предоставить простой Telegram-интерфейс для создания задач, запуска/остановки таймера, хранения сессий работы, генерации отчётов и экспорта данных.
   Требования пользователя (ключевые):
   - Создание и управление списком задач (до 20 задач на пользователя);
   - Запуск трекинга выбранной задачи одним нажатием кнопки;
   - Остановка таймера кнопкой «Остановить таймер» с автоматическим сохранением сессии;
   - Просмотр статистики за неделю по всем задачам;
   - Экспорт данных в текстовый файл;
   - Хранение данных 5 лет.


#### 2. Входные числа и допущения
   - Пользователей в сутки: 1 000.
   - Среднее число сессий таймера на пользователя в сутки: 3.
   - Среднее число взаимодействий (команд/кнопок) на пользователя в сутки: 8.
   - Средний размер записи сессии: 0.5 KB.
   - Максимальное количество задач на пользователя: 20.
   - Срок хранения: 5 лет.


#### 3. Оценка нагрузки и объёмов данных
   Операции в день:
     - Сессии таймера (writes): 3 000/день.
     - Операции с задачами (CRUD): 2 000/день.
     - Запросы отчётов и статистики: 3 000/день.
     - Итого: ~8 000/день.
   Среднее RPS: 0.1, Пиковое: ~5.
   Хранилище: ~50 GB за 5 лет, рекомендуется 100 GB SSD.



#### 4. Высокоуровневая архитектура
   Компоненты:
   1. Telegram Bot (Long Polling)
   2. Spring Boot Application (stateless)
   3. PostgreSQL (Primary)
   4. In-memory User Sessions (HashMap)
   5. File System (для временных файлов экспорта)



#### 5. Telegram-специфика
   - Long Polling (TelegramLongPollingBot)
   - Обработка текстовых сообщений и кнопок меню
   - State machine: IDLE, WAITING_TASK_SELECTION, WAITING_NEW_TASK_NAME, WAITING_TASK_DELETION, TIMER_RUNNING
   - Интуитивная клавиатура с кнопками действий



#### 6. Поведение бота (state machine)
   Состояния: IDLE, WAITING_TASK_SELECTION, WAITING_NEW_TASK_NAME, WAITING_TASK_DELETION, TIMER_RUNNING.
   - Один активный таймер на пользователя
   - Start → сохранение времени начала в UserSession
   - End → расчёт длительности, запись в БД, очистка сессии



#### 7. API (внутренние контракты)
   Spring Data JPA репозитории:
   - UserDataRepository - для хранения сессий таймера
   - UserTaskRepository - для управления задачами
   Методы: findByUserId, save, delete, findByStartTimeBetween



#### 8. БД схема
   Основные таблицы:
   - user_data (id, user_id, task_name, start_time, end_time, duration_minutes, created_at)
   - user_task (id, user_id, task_name, usage_count, created_at)
   Индексы: по user_id, start_time для эффективных запросов отчётов.



#### 9. Кэширование и очереди
   - UserSession: in-memory хранение состояний пользователей (HashMap)
   - Лимит задач: валидация при создании (MAX_TASKS_PER_USER = 20)
   - Валидация данных: длина названия задачи ≤ 50 символов



#### 10. Нефункциональные требования
   - Простота и надежность работы
   - Ограничение на количество задач пользователя (20)
   - Валидация входных данных
   - Очистка временных файлов экспорта



#### 11. Масштабирование
   Текущая архитектура: 1 экземпляр приложения, PostgreSQL
   При росте: добавление реплик PostgreSQL, кэширование частых запросов



#### 12. Резервное копирование
   - Регулярное backup PostgreSQL
   - Хранение backup на отдельном носителе
   - Восстановление из backup при необходимости



#### 13. Мониторинг
   - Логирование в консоль (Spring Boot Logging)
   - Мониторинг ошибок через try-catch блоки
   - Отслеживание количества пользователей и сессий



#### 14. Безопасность
   - Хранение токенов в application.properties
   - Валидация входных данных (длина названия задачи)
   - Очистка временных файлов экспорта после отправки



#### 15. Runbook
   - Try-catch блоки вокруг критических операций
   - Информативные сообщения об ошибках пользователю
   - Fallback на главное меню при неожиданных ошибках



#### 16. UI/UX
   Главное меню: [Начать отсчет дела], [Мои дела], [Отчет за неделю], [Выгрузить данные]
   Примеры сообщений:
   - «Таймер запущен! Задача: Программирование»
   - «Таймер остановлен! Длительность: 45 минут»
   - «Отчет за неделю: всего 12 часов 30 минут»



#### 17. Инфраструктура
   App: 1 экземпляр, 1 vCPU, 2 GB RAM (Spring Boot)
   DB: Postgres 2 vCPU, 8 GB RAM, SSD 100 GB
   Файловая система: для временных файлов экспорта



#### 18. Заключение
   Архитектура поддерживает 1k пользователей/сутки с возможностью масштабирования.
   Ключевые особенности: простое управление задачами, автоматический учёт времени, детальная статистика, удобный экспорт данных.
   Основные преимущества: минимальные зависимости, простая настройка, надежная работа.

